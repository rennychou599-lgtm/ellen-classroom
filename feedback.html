<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€å¸«å›é¥‹ | éˆºå€«ã®æ•™å®¤</title>
    <link rel="icon" type="image/png" href="images2/Ellennoback.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Long+Cang&family=Zhi+Mang+Xing&family=Ma+Shan+Zheng&family=Caveat:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .feedback-page {
            min-height: 80vh;
            padding: 4rem 2rem;
            background: #ffffff;
        }

        .feedback-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .login-card {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        /* åˆå§‹ç‹€æ…‹ï¼šå¦‚æœå·²ç™»å…¥ï¼Œéš±è—ç™»å…¥è¡¨å–® */
        .login-card.checking-login {
            opacity: 0;
            pointer-events: none;
        }

        .login-card h2 {
            color: #000000;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            color: #2c3e50;
        }

        .form-group input:focus {
            outline: none;
            border-color: #34495e;
            box-shadow: 0 0 0 2px rgba(52, 73, 94, 0.1);
        }

        .form-group label {
            color: #2c3e50;
            font-weight: 500;
        }

        .login-btn {
            width: 100%;
            padding: 0.75rem;
            background: #000000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .feedback-display {
            display: none;
        }

        .feedback-display.active {
            display: block;
        }

        .student-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border: 2px solid #e1e8ed;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .student-info-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .student-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
        }

        .student-info-text h3 {
            color: #2c3e50;
            margin: 0 0 0.25rem 0;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .student-info-text p {
            margin: 0;
            color: #5a6c7d;
            font-size: 0.9rem;
        }

        .student-info-actions {
            display: flex;
            gap: 0.75rem;
        }

        .back-btn,
        .logout-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn {
            background: white;
            color: #3498db;
            border: 2px solid #3498db;
        }

        .back-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .logout-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .feedback-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .feedback-card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 2px solid #e1e8ed;
            transition: all 0.3s ease;
            position: relative;
            margin-bottom: 1.5rem;
            cursor: pointer;
        }

        /* ä¿¡ä»¶æ¨£å¼ - æœªè®€å– */
        .feedback-card.unread {
            border-left: 5px solid #3498db;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 4px 16px rgba(52, 152, 219, 0.15);
        }

        .feedback-card.unread::before {
            content: '';
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 12px;
            height: 12px;
            background: #3498db;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
        }

        /* ä¿¡ä»¶æ¨£å¼ - å·²è®€å– */
        .feedback-card.read {
            border-left: 5px solid #95a5a6;
            background: #ffffff;
            opacity: 0.9;
        }

        .feedback-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        .feedback-card.unread:hover {
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.2);
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e1e8ed;
        }

        .feedback-card.unread .feedback-header {
            border-bottom-color: #d5e8f7;
        }

        .feedback-date {
            color: #5a6c7d;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-card.unread .feedback-date {
            color: #2c3e50;
            font-weight: 600;
        }

        .feedback-card.unread .feedback-date::before {
            content: 'ğŸ“¬';
            font-size: 1rem;
        }

        .feedback-card.read .feedback-date::before {
            content: 'ğŸ“­';
            font-size: 1rem;
        }

        .feedback-subject {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(44, 62, 80, 0.2);
        }

        .feedback-stats {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .stat-badge {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 184, 148, 0.35);
            transition: all 0.3s ease;
        }

        .stat-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.4);
        }

        .feedback-content {
            color: #2c3e50;
            line-height: 1.8;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #e1e8ed;
        }

        .feedback-card.unread .feedback-content {
            background: linear-gradient(135deg, #ebf5fb 0%, #f8f9fa 100%);
            border-left-color: #3498db;
            font-weight: 500;
        }

        .feedback-card.read .feedback-content {
            background: #f8f9fa;
            opacity: 0.85;
        }

        .feedback-teacher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #3498db;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #5a6c7d;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid #e1e8ed;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #bdc3c7;
        }
    </style>
</head>

<body>
    <!-- å°èˆªæ¬„ -->
    <header class="site-header">
        <div class="header-container">
            <!-- Logo -->
            <div class="site-branding">
                <a href="index.html" class="logo-link">
                    <img src="images2/Ellennoback.png" alt="éˆºå€«ã®æ•™å®¤ Logo" class="logo-image">
                    <div class="logo-text">
                        <span class="site-title">éˆºå€«ã®æ•™å®¤</span>
                        <span class="site-tagline">Ellen's class</span>
                    </div>
                </a>
            </div>

            <!-- Header å€’æ•¸é¡¯ç¤º -->
            <div class="header-countdown" aria-live="polite">
                <i class="fas fa-hourglass-half"></i>
                <span id="headerCountdown">æœƒè€ƒå€’æ•¸ 0 å¤©</span>
            </div>

            <!-- ä¸»å°èˆªèœå–® -->
            <nav class="main-navigation">
                <ul class="nav-menu">
                    <li class="menu-item">
                        <a href="index.html" class="menu-link">
                            <i class="fas fa-home"></i>
                            <span>é¦–é </span>
                        </a>
                    </li>
                    <li class="menu-item menu-item-has-children">
                        <a href="#" class="menu-link">
                            <i class="fas fa-calendar-check"></i>
                            <span>æœƒè€ƒé ˆçŸ¥</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="index.html#exam-time" class="menu-link">è€ƒè©¦æ™‚é–“</a></li>
                            <li><a href="index.html#exam-subjects" class="menu-link">è€ƒè©¦ç§‘ç›®èˆ‡ç¯„åœ</a></li>
                            <li><a href="index.html#exam-location" class="menu-link">è€ƒè©¦åœ°é»</a></li>
                            <li><a href="index.html#exam-important" class="menu-link">é‡è¦äº‹é …</a></li>
                        </ul>
                    </li>
                    <li class="menu-item menu-item-has-children">
                        <a href="#" class="menu-link">
                            <i class="fas fa-book"></i>
                            <span>å­¸ç¿’åœ°åœ–</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="grades.html" class="menu-link"><i class="fas fa-chart-line"></i><span>æˆç¸¾è¿½è¹¤</span></a></li>
                            <li><a href="reflection.html" class="menu-link"><i class="fas fa-lightbulb"></i><span>å­¸ç¿’å¿ƒå¾—</span></a></li>
                            <li><a href="progress.html" class="menu-link"><i class="fas fa-tasks"></i><span>è¤‡ç¿’é€²åº¦</span></a></li>
                            <li><a href="feedback.html" class="menu-link"><i class="fas fa-comments"></i><span>è€å¸«å›é¥‹</span></a></li>
                        </ul>
                    </li>
                    <li class="menu-item menu-item-has-children">
                        <a href="#" class="menu-link">
                            <i class="fas fa-book-reader"></i>
                            <span>ç­ç´šé»æ»´</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <ul class="sub-menu">
                            <li><a href="class-901.html" class="menu-link">ä¹å¹´ä¸€ç­</a></li>
                        </ul>
                    </li>
                    <li class="menu-item">
                        <a href="index.html#about" class="menu-link">
                            <i class="fas fa-user-graduate"></i>
                            <span>é—œæ–¼æœ¬ç«™</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- å³å´æŒ‰éˆ• -->
            <div class="header-actions">
                <button class="btn btn-outline" id="searchBtn">
                    <i class="fas fa-search"></i>
                    <span>æœå°‹</span>
                </button>
                <button class="btn btn-outline" id="loginBtn">
                    <i class="fas fa-user"></i>
                    <span>æœƒå“¡ç™»å…¥</span>
                </button>
            </div>

            <!-- è¡Œå‹•é¸å–®æŒ‰éˆ• -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="é¸å–®">
                <span class="hamburger-icon"></span>
            </button>
        </div>
    </header>

    <!-- è€å¸«å›é¥‹é é¢ -->
    <section class="feedback-page">
        <div class="feedback-container">
            <!-- ç™»å…¥è¡¨å–® -->
            <div class="login-card checking-login" id="loginCard">
                <h2><i class="fas fa-comments"></i> è€å¸«å›é¥‹ç³»çµ±</h2>
                <div class="error-message" id="errorMessage">
                    <i class="fas fa-exclamation-circle"></i> å­¸è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="studentId"><i class="fas fa-id-card"></i> å­¸è™Ÿ</label>
                        <input type="text" id="studentId" name="studentId" placeholder="è«‹è¼¸å…¥å­¸è™Ÿ" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-lock"></i> å¯†ç¢¼</label>
                        <input type="password" id="password" name="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                    </div>
                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i> ç™»å…¥
                    </button>
                </form>
            </div>

            <!-- è€å¸«å›é¥‹åŠŸèƒ½å€ -->
            <div class="feedback-display" id="feedbackDisplay">
                <div class="student-info">
                    <div class="student-info-left">
                        <div class="student-avatar" id="studentAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="student-info-text">
                            <h3><span id="displayStudentName">å­¸ç”Ÿ</span></h3>
                            <p><i class="fas fa-id-card"></i> å­¸è™Ÿï¼š<span id="displayStudentId">-</span></p>
                        </div>
                    </div>
                    <div class="student-info-actions">
                        <a href="index.html" class="back-btn">
                            <i class="fas fa-home"></i> è¿”å›é¦–é 
                        </a>
                        <button class="logout-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> ç™»å‡º
                        </button>
                    </div>
                </div>

                <!-- æ”¶ä¿¡æç¤ºèˆ‡çµ±è¨ˆ -->
                <div
                    style="margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 12px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08); border: 1px solid #e1e8ed;">
                    <!-- æ”¶ä¿¡æç¤º -->
                    <div
                        style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e1e8ed;">
                        <img src="images2/post.png" alt="æ”¶ä¿¡"
                            style="width: 80px; height: auto; flex-shrink: 0; object-fit: contain;">
                        <p style="color: #2c3e50; font-size: 1.2rem; font-weight: 600; margin: 0;">
                            éˆºå€«è€å¸«ï¼šåŒå­¸ï¼Œè«‹æ”¶ä¿¡å›‰ï¼
                        </p>
                    </div>

                    <!-- çµ±è¨ˆè³‡è¨Š -->
                    <div class="feedback-stats"
                        style="display: flex; gap: 1.5rem; flex-wrap: wrap; align-items: center; justify-content: center;">
                        <div class="stat-badge">
                            <i class="fas fa-envelope"></i>
                            <span>æ‰€æœ‰ä¿¡ä»¶ï¼š<strong id="totalFeedbackCount">0</strong></span>
                        </div>
                        <div class="stat-badge">
                            <i class="fas fa-envelope-open"></i>
                            <span>æœªè®€å–ï¼š<strong id="unreadFeedbackCount">0</strong></span>
                        </div>
                    </div>
                </div>

                <div class="feedback-list" id="feedbackList">
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <p>ç›®å‰é‚„æ²’æœ‰è€å¸«å›é¥‹<br>è€å¸«æœƒæ ¹æ“šä½ çš„å­¸ç¿’ç‹€æ³çµ¦äºˆå›é¥‹</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-info">
                    <div class="footer-logo">
                        <i class="fas fa-graduation-cap"></i>
                        <span>éˆºå€«ã®æ•™å®¤</span>
                    </div>
                    <p class="footer-description">
                        å°ˆæ¥­çš„å­¸ç¿’ç®¡ç†å¹³å°<br>
                        é™ªä¼´å­¸ç”Ÿé‚å‘æˆåŠŸ
                    </p>
                </div>
                <div class="footer-links">
                    <h4>å¿«é€Ÿé€£çµ</h4>
                    <ul>
                        <li><a href="index.html">é¦–é </a></li>
                        <li><a href="index.html#exam-time">è€ƒè©¦æ™‚é–“</a></li>
                        <li><a href="index.html#exam-subjects">è€ƒè©¦ç§‘ç›®èˆ‡ç¯„åœ</a></li>
                        <li><a href="index.html#course">èª²ç¨‹å…§å®¹</a></li>
                        <li><a href="aboutme.html">é—œæ–¼è€å¸«</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>è¯çµ¡è³‡è¨Š</h4>
                    <p><i class="fas fa-envelope"></i> ellen@example.com</p>
                    <p><i class="fas fa-phone"></i> (02) 1234-5678</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 éˆºå€«ã®æ•™å®¤. All rights reserved. <span style="margin-left: 1rem; color: #5a6c7d;">Version
                        1.0</span></p>
            </div>
        </div>
    </footer>

    <script>
        // æœƒè€ƒå€’æ•¸è¨ˆæ™‚
        function updateCountdown() {
            const examDate = new Date('2026-05-15T09:00:00');
            const now = new Date();
            const timeLeft = examDate - now;

            if (timeLeft < 0) {
                const headerEl = document.getElementById('headerCountdown');
                if (headerEl) headerEl.textContent = 'æœƒè€ƒå€’æ•¸ 0 å¤©';
                return;
            }

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const headerEl = document.getElementById('headerCountdown');
            if (headerEl) headerEl.textContent = `æœƒè€ƒå€’æ•¸ ${days} å¤©`;
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);

        // ========================================
        // API æœå‹™å±¤ï¼ˆæ–¹ä¾¿ä¹‹å¾Œæ›¿æ›ç‚ºå¾Œç«¯APIï¼‰
        // ========================================
        const ApiService = {
            async login(studentId, password) {
                await new Promise(resolve => setTimeout(resolve, 300));
                return this.getStudentData(studentId, password);
            },

            getStudentData(studentId, password) {
                const student = studentsDatabase[studentId];
                if (student && student.password === password) {
                    return { success: true, data: student };
                }
                return { success: false, message: 'å­¸è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' };
            },

            // ç²å–è€å¸«å›é¥‹ï¼ˆä¹‹å¾Œå¯æ›¿æ›ç‚ºï¼šGET /api/students/:id/feedbackï¼‰
            async getFeedback(studentId) {
                await new Promise(resolve => setTimeout(resolve, 200));
                return feedbackDatabase[studentId] || [];
            }
        };

        // ========================================
        // æ¨¡æ“¬è³‡æ–™åº«ï¼ˆä¹‹å¾Œå°‡ç”±å¾Œç«¯APIå–ä»£ï¼‰
        // ========================================
        const studentsDatabase = {
            'A100': {
                password: '999',
                name: 'æ¸¬è©¦å­¸ç”Ÿ'
            },
            '1001': {
                password: '1234', name: 'ç‹å°æ˜'
            },
            '1002': {
                password: '1234', name: 'å¼µä¸‰'
            },
            '1003': {
                password: '1234', name: 'æå››'
            }
        };

        // æ¨¡æ“¬è€å¸«å›é¥‹è³‡æ–™ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²å¾å¾Œç«¯APIç²å–ï¼‰
        const feedbackDatabase = {
            'A100': [
                {
                    date: '2025/12/25',
                    subject: 'ç¶œåˆè¡¨ç¾',
                    content: 'æ¸¬è©¦å­¸ç”Ÿæ•´é«”è¡¨ç¾å„ªç§€ï¼Œå„ç§‘æˆç¸¾ç©©å®šã€‚å»ºè­°å¯ä»¥åŠ å¼·æ•¸å­¸çš„æ‡‰ç”¨é¡Œç·´ç¿’ï¼Œæå‡è§£é¡ŒæŠ€å·§ã€‚ç¹¼çºŒä¿æŒå­¸ç¿’ç†±å¿±ï¼',
                    teacher: 'éˆºå€«è€å¸«'
                },
                {
                    date: '2025/12/20',
                    subject: 'è‹±æ–‡',
                    content: 'è‹±æ–‡æˆç¸¾é€²æ­¥æ˜é¡¯ï¼Œå–®å­—é‡æŒçºŒå¢åŠ ã€‚å»ºè­°å¤šé–±è®€è‹±æ–‡æ–‡ç« ï¼Œæå‡èªæ„Ÿå’Œé–±è®€ç†è§£èƒ½åŠ›ã€‚',
                    teacher: 'éˆºå€«è€å¸«'
                }
            ],
            '1001': [
                {
                    date: '2025/12/20',
                    subject: 'åœ‹æ–‡',
                    content: 'å°æ˜åœ¨åœ‹æ–‡æ–¹é¢è¡¨ç¾å„ªç§€ï¼Œé–±è®€ç†è§£èƒ½åŠ›å¾ˆå¼·ã€‚å»ºè­°å¯ä»¥å¤šç·´ç¿’å¯«ä½œï¼Œæå‡è¡¨é”èƒ½åŠ›ã€‚',
                    teacher: 'éˆºå€«è€å¸«'
                },
                {
                    date: '2025/12/15',
                    subject: 'æ•¸å­¸',
                    content: 'æ•¸å­¸åŸºç¤ç©©å›ºï¼Œä½†åœ¨æ‡‰ç”¨é¡Œæ–¹é¢é‚„éœ€è¦åŠ å¼·ã€‚å»ºè­°å¤šåšç·´ç¿’é¡Œï¼ŒåŸ¹é¤Šè§£é¡Œæ€è·¯ã€‚',
                    teacher: 'éˆºå€«è€å¸«'
                }
            ],
            '1002': [
                {
                    date: '2025/12/22',
                    subject: 'è‹±æ–‡',
                    content: 'å¼µä¸‰çš„è‹±æ–‡æˆç¸¾éå¸¸å„ªç§€ï¼Œå–®å­—é‡è±å¯Œã€‚å»ºè­°å¯ä»¥å¤šé–±è®€è‹±æ–‡æ–‡ç« ï¼Œæå‡èªæ„Ÿã€‚',
                    teacher: 'éˆºå€«è€å¸«'
                }
            ],
            '1003': [
                {
                    date: '2025/12/25',
                    subject: 'åœ‹æ–‡',
                    content: 'æå››å„æ–¹é¢è¡¨ç¾éƒ½å¾ˆå„ªç§€ï¼Œæ˜¯ç­ä¸Šçš„æ¨¡ç¯„ç”Ÿã€‚ç¹¼çºŒä¿æŒï¼Œç›¸ä¿¡æœƒè€ƒä¸€å®šèƒ½å–å¾—å¥½æˆç¸¾ï¼',
                    teacher: 'éˆºå€«è€å¸«'
                }
            ]
        };

        // ç™»å…¥è¡¨å–®è™•ç†
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const studentId = document.getElementById('studentId').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            // ä½¿ç”¨APIæœå‹™é€²è¡Œç™»å…¥é©—è­‰
            const result = await ApiService.login(studentId, password);

            if (result.success) {
                // ç™»å…¥æˆåŠŸ
                errorMessage.classList.remove('active');
                // ä¿å­˜ç™»å…¥ç‹€æ…‹
                const student = result.data;
                if (typeof AuthManager !== 'undefined') {
                    AuthManager.saveLogin(studentId, student.name);
                }
                showFeedback(studentId);
            } else {
                // ç™»å…¥å¤±æ•—
                errorMessage.classList.add('active');
            }
        });

        // é¡¯ç¤ºè€å¸«å›é¥‹åŠŸèƒ½
        async function showFeedback(studentId) {
            // ç²å–å­¸ç”Ÿè³‡æ–™
            let student;
            if (studentsDatabase[studentId]) {
                student = studentsDatabase[studentId];
            } else {
                const studentResult = await ApiService.getStudentData(studentId, '');
                if (studentResult.success) {
                    student = studentResult.data;
                } else {
                    console.error('ç„¡æ³•ç²å–å­¸ç”Ÿè³‡æ–™');
                    return;
                }
            }
            const loginCard = document.getElementById('loginCard');
            const feedbackDisplay = document.getElementById('feedbackDisplay');

            // éš±è—ç™»å…¥è¡¨å–®ï¼Œé¡¯ç¤ºåŠŸèƒ½å€
            loginCard.style.display = 'none';
            feedbackDisplay.classList.add('active');

            // é¡¯ç¤ºå­¸ç”Ÿå§“åå’Œå­¸è™Ÿ
            document.getElementById('displayStudentName').textContent = student.name;
            document.getElementById('displayStudentId').textContent = studentId;

            // æ›´æ–°é ­åƒé¡¯ç¤ºå­¸ç”Ÿå§“åé¦–å­—
            const avatar = document.getElementById('studentAvatar');
            avatar.innerHTML = student.name.charAt(0);

            // è¼‰å…¥è€å¸«å›é¥‹ï¼ˆä½¿ç”¨APIæœå‹™ï¼‰
            await loadFeedback(studentId);
        }

        // è¼‰å…¥è€å¸«å›é¥‹
        async function loadFeedback(studentId) {
            const feedbackList = document.getElementById('feedbackList');
            const feedbacks = await ApiService.getFeedback(studentId);

            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            document.getElementById('totalFeedbackCount').textContent = feedbacks.length;

            if (feedbacks.length === 0) {
                document.getElementById('unreadFeedbackCount').textContent = 0;
                feedbackList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <p>ç›®å‰é‚„æ²’æœ‰è€å¸«å›é¥‹<br>è€å¸«æœƒæ ¹æ“šä½ çš„å­¸ç¿’ç‹€æ³çµ¦äºˆå›é¥‹</p>
                    </div>
                `;
                return;
            }

            let unreadCount = 0;

            feedbackList.innerHTML = feedbacks.map((feedback, index) => {
                // æª¢æŸ¥æ˜¯å¦å·²è®€å–ï¼ˆå¾ localStorageï¼‰
                const readKey = `feedback_read_${studentId}_${index}`;
                const isRead = localStorage.getItem(readKey) === 'true';
                const cardClass = isRead ? 'read' : 'unread';

                // çµ±è¨ˆæœªè®€å–æ•¸é‡
                if (!isRead) {
                    unreadCount++;
                }

                return `
                <div class="feedback-card ${cardClass}" data-index="${index}" data-student-id="${studentId}">
                    <div class="feedback-header">
                        <span class="feedback-date">${feedback.date}</span>
                        <span class="feedback-subject">${feedback.subject}</span>
                    </div>
                    <div class="feedback-content">
                        ${feedback.content}
                    </div>
                    <div class="feedback-teacher">
                        <i class="fas fa-user-tie"></i>
                        <span>${feedback.teacher}</span>
                    </div>
                </div>
            `;
            }).join('');

            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            document.getElementById('totalFeedbackCount').textContent = feedbacks.length;
            document.getElementById('unreadFeedbackCount').textContent = unreadCount;

            // æ·»åŠ é»æ“Šäº‹ä»¶ï¼šæ¨™è¨˜ç‚ºå·²è®€
            document.querySelectorAll('.feedback-card').forEach(card => {
                card.addEventListener('click', function () {
                    const studentId = this.dataset.studentId;
                    const index = this.dataset.index;
                    const readKey = `feedback_read_${studentId}_${index}`;

                    if (!localStorage.getItem(readKey)) {
                        localStorage.setItem(readKey, 'true');
                        this.classList.remove('unread');
                        this.classList.add('read');

                        // æ›´æ–°æœªè®€å–æ•¸é‡
                        const currentUnread = parseInt(document.getElementById('unreadFeedbackCount').textContent);
                        document.getElementById('unreadFeedbackCount').textContent = Math.max(0, currentUnread - 1);
                    }
                });
            });
        }

        // ç™»å‡ºåŠŸèƒ½
        document.getElementById('logoutBtn')?.addEventListener('click', function () {
            // ä½¿ç”¨ AuthManager çµ±ä¸€ç™»å‡ºï¼Œæ¸…é™¤å…¨å±€ç™»å…¥ç‹€æ…‹ä¸¦è·³è½‰åˆ°é¦–é 
            if (typeof AuthManager !== 'undefined') {
                AuthManager.logout();
            } else {
                // å¦‚æœ AuthManager æœªåŠ è¼‰ï¼Œæ‰‹å‹•æ¸…é™¤ç™»å…¥ç‹€æ…‹
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        });

        // ç«‹å³æª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼ˆä¸ç­‰å¾… DOMContentLoadedï¼‰
        (function checkLoginStatusImmediately() {
            // åŒæ­¥æª¢æŸ¥ localStorageï¼ˆä¸ä¾è³´ auth.jsï¼‰
            try {
                const currentUserData = localStorage.getItem('currentUser');
                if (currentUserData) {
                    const currentUser = JSON.parse(currentUserData);
                    if (currentUser && currentUser.studentId) {
                        const studentId = currentUser.studentId;
                        // ç«‹å³éš±è—ç™»å…¥è¡¨å–®
                        const loginCard = document.getElementById('loginCard');
                        if (loginCard) {
                            loginCard.classList.remove('checking-login');
                            loginCard.style.display = 'none';
                        }
                        // ç­‰å¾… DOM åŠ è¼‰å®Œæˆå¾Œé¡¯ç¤ºå…§å®¹
                        if (document.readyState === 'loading') {
                            document.addEventListener('DOMContentLoaded', async function () {
                                if (studentsDatabase[studentId]) {
                                    await showFeedback(studentId);
                                }
                            });
                        } else {
                            if (studentsDatabase[studentId]) {
                                showFeedback(studentId);
                            }
                        }
                        return; // å·²ç™»å…¥ï¼Œä¸éœ€è¦ç¹¼çºŒ
                    }
                }
            } catch (e) {
                console.error('æª¢æŸ¥ç™»å…¥ç‹€æ…‹æ™‚å‡ºéŒ¯:', e);
            }

            // æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥è¡¨å–®
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function () {
                    const loginCard = document.getElementById('loginCard');
                    if (loginCard) {
                        loginCard.classList.remove('checking-login');
                        loginCard.style.display = 'block';
                    }
                });
            } else {
                const loginCard = document.getElementById('loginCard');
                if (loginCard) {
                    loginCard.classList.remove('checking-login');
                    loginCard.style.display = 'block';
                }
            }
        })();
    </script>
    <script src="auth.js"></script>
</body>

</html>